{% extends "base.html" %}
{% load static %}

{% block title %}Explore Recipes | Gastronomy App{% endblock %}

{% block extra_css %}
<style>
    body { font-family: 'Lato', sans-serif; background-color: #f8f9fa; }
    .section-title { font-family: 'Playfair Display', serif; font-weight: 700; color: #2c3e50; }
    
    .recipe-card { 
        transition: transform 0.3s ease, box-shadow 0.3s ease; 
        border: none; 
        border-radius: 15px; 
        overflow: hidden; 
        height: 100%; 
        position: relative; 
    }
    .recipe-card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
    
    .img-container { position: relative; }

    /* Difficulty Pill Overlay */
    .difficulty-pill {
        position: absolute;
        top: 15px;
        right: 15px;
        padding: 5px 15px;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        color: white;
        z-index: 10;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }

    .diff-easy { background-color: #27ae60; }
    .diff-medium { background-color: #f39c12; }
    .diff-hard { background-color: #e74c3c; }

    .btn-view { background-color: #2c3e50; color: white; border-radius: 8px; font-weight: 600; }
    .btn-view:hover { background-color: #e67e22; color: white; }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row mb-5 align-items-center">

        <div class="col-md-7">
            <h1 class="section-title display-5">Our Recipe Collection</h1>
        </div>

        <div class="col-md-5">
            <div class="d-flex justify-content-md-end">
                <input type="text" id="recipeSearch" class="form-control w-75 me-2" placeholder="Filter by name...">
            </div>
        </div>

    </div>

    <div class="row g-4">

        {% for recipe in recipes %}
        <div class="col-md-6 col-lg-4 recipe-item" data-name="{{ recipe.name|lower }}">
            <div class="card recipe-card shadow-sm">
                <div class="img-container">
                    <span class="difficulty-pill diff-{{ recipe.difficulty }}">
                        {{ recipe.difficulty }}
                    </span>

                    {% if recipe.image and recipe.image.name != 'no_image.png' %}
                        <img src="{{ recipe.image.url }}" class="card-img-top" alt="{{ recipe.name }}" style="height: 250px; object-fit: cover;">
                    {% else %}
                        <img src="{% static 'img/no_image.png' %}" class="card-img-top" alt="Default Recipe Image" style="height: 250px; object-fit: cover;">
                    {% endif %}
                </div>

                <div class="card-body d-flex flex-column">
                    <h4 class="card-title fw-bold mb-2">{{ recipe.name }}</h4>
                    <p class="text-muted small mb-3">
                        Ready in <strong>{{ recipe.cooking_time }} minutes</strong>
                    </p>
                    <div class="mt-auto d-grid">
                        <a href="{% url 'recipes:recipe_detail' recipe.pk %}" class="btn btn-view py-2">View Details</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        <div id="noResults" class="col-12 text-center py-5 d-none">
            <h3 class="text-muted">No recipes match your filter.</h3>
        </div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('recipeSearch').addEventListener('keyup', function() {
        const query = this.value.toLowerCase();
        const recipes = document.querySelectorAll('.recipe-item');
        const noResults = document.getElementById('noResults');
        let visibleCount = 0;

        recipes.forEach(recipe => {
            const name = recipe.getAttribute('data-name');
            if (name.includes(query)) {
                recipe.style.display = "block";
                visibleCount++;
            } else {
                recipe.style.display = "none";
            }
        });

        // Toggle the "No results" message based on the count
        if (visibleCount === 0) {
            noResults.classList.remove('d-none');
        } else {
            noResults.classList.add('d-none');
        }
    });
</script>
{% endblock %}

